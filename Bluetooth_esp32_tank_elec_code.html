<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="description" content="Learn how to make your own DIY, free electric skateboard by using a recycled scooter and old skateboard.">
    <title>ThunderCode.io/Bluetooth esp32 tank l293d BluetoothSerial MIT App Inventor</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" />
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
    <!-- MDB -->
    <link rel="stylesheet" href="css/mdb.min.css" />
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
      <header>
    <!-- Intro settings -->
    <style>
      #intro {
        /* Margin to fix overlapping fixed navbar */
        margin-top: 58px;
      }
      @media (max-width: 991px) {
        #intro {
          /* Margin to fix overlapping fixed navbar */
          margin-top: 45px;
        }
      }
    </style>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top">
      <div class="container-fluid">
        <!-- Navbar brand -->
        <a class="navbar-brand" href="https://getgetstechno.github.io/ThunderCode.io/">
          <img src="img/icon/logo64.png" height="35" alt="logo" loading="lazy"
            style="margin-top: -3px;" />
        </a>
        <button class="navbar-toggler" type="button" data-mdb-toggle="collapse" data-mdb-target="#navbarExample01"
          aria-controls="navbarExample01" aria-expanded="false" aria-label="Toggle navigation">
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarExample01">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item active">
              <a class="nav-link" aria-current="page" href="index.html">HOME</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="embedded_systems.html" rel="nofollow"
                >All Projects</a>
            </li>
          </ul>

          <ul class="navbar-nav d-flex flex-row">
            <!-- Icons -->
            <li class="nav-item me-3 me-lg-0">
              <a class="nav-link" href="https://github.com/getgetstechno?tab=repositories" rel="nofollow" target="_blank">
                <i class="fab fa-github"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Navbar -->

    <!-- Jumbotron -->
    <div id="intro" class="p-5 text-center bg-light">
      <h1 class="mb-3 h2">Bluetooth ESP32 tank using MIT App Inventor</h1>
      <p class="mb-3">Here I will teach you how I build the electronic and code part of my Bluetooth controlled tank using an esp32, and the MIT app Inventor.</p>
      <a class="btn btn-primary m-2" href="embedded_systems.html" role="button" rel="nofollow"
        >All Projects</a>
    </div>
    <!-- Jumbotron -->
  </header>
  <!--Main Navigation-->

  <!--Main layout-->
  <main class="my-5">
    <div class="container">
      <!--Section: Content-->
      <section class="text-center">
        <h2 class="title_text"><strong>Introduction</strong></h2>
            <div class="text_text">
              Quickly after I made the arduino rc car, I wanted to experiment with another communication
              method instead of radio signals using the nRF24l01 module. That’s why I decided to learn
              more about Bluetooth. I already watched and read some tutorials, but they were never completed.
              Here I will explain to you all the electronics and programming (esp32 and MIT app inventor)
              steps to make your own Bluetooth controlled tank using your smartphone. The first step will
              be to make our own App using the free MIT app Inventor website and then to code our esp32 using
              the Arduino IDE.
            </div>

        <h3 class="title_text"><strong>Goals</strong></h3>
          <div class="text_text">
            Well, in this project our goal will be to control two motors on an esp32 using our smartphone.
            Like you can see in the next photo, the interface of my app will be very simple. We will control
            the direction of our tank by clicking on the buttons underneed. Of course this project is not finished,
            we will add some leds and other controls later but today we will learn the basics of our tank. Interested?
            Well let’s start!
            <br>
          </div>
          <div class="row_images">
            <div class="column_image">
              <img src="img/bluetooth_rc_car/notConnectedNew.jpg" alt="not connected" style="width:100%">
            </div>
            <div class="column_image">
              <img src="img/bluetooth_rc_car/connectedNew.jpg" alt="connected" style="width:100%">
            </div>
          </div>
        <h3 class="title_text"><strong>Electronic part</strong></h3>
          <div class="text_text">
            The electronic part is really easy. I will use 2 9V DC motors that I will control using an l293d motor shield.
            The four pins that I will use to control the rotation of the motor are the 33, 25, 27 and 26 on my esp32-WROOM-32
            model. The motors will always rotate at 100% of speed (so no PWM). Here is a picture :
            <br>
          </div>
          <div class="row_images">
            <div class="column_image">
              <img src="img/bluetooth_rc_car/chemaNew.JPG" alt="circuit" style="width:100%">
            </div>
            <div class="column_image">
              <img src="img/bluetooth_rc_car/chemaNew1.JPG" alt="schema" style="width:100%">
            </div>
          </div>

        <h3 class="title_text"><strong>MIT App Inventor</strong></h3>
          <div class="text_text">
            The mit app inventor is a very good website to make your own little apps on mobile (IOS and Android (for Bluetooth only Android!!!)).
            Certainly if it is a temporary app where you don’t want to spend days making it.  To make it, you will
            firstly have to go to the official website of the MIT app inventor. Here is the link :
            <a href="https://appinventor.mit.edu/">https://appinventor.mit.edu/</a>. Then you can click on the button
            “create app” to build an app. After you make an account you will come to a page where you can build your app.
            <br>
            Here you can click on the button “start new project” on the top left corner. Name it, and now you will
            come to a page like that one :
            <br><br><br>
            <div class="row_images">
              <div class="column_image">
                <img src="img/bluetooth_rc_car/MITintro.png" alt="Snow" style="width:100%">
              </div>
            </div>
            <br>
            The first step is to make the layout of our app, we will make the interactions later. The system is
            pretty simple because you just have to drag and drop what you want on the screen. Take some time to
            discover all the different palettes with their components. For our tutorial, we will use only a few
            components. In the “user interface” palette we will only use a button, label and a listpicker.
            In the layout palette, we will only use the horizontal and table arrangement. These will make our app
            nice looking. In the sensor palette, we will use the clock component and in the connectivity palette,
            we will use the Bluetooth Client component. Our clock component will start a function every time interval
            (default every second but you can change it in the properties). The BluetoothClient component will make
            our Bluetooth connection possible. Don’t panic if you don’t see the elements on the screen, these will
            never appear. Now you can just drag and drop the elements on the screen. They will also appear in the
            component palette. Here is an overview of how I made my app.
            <br><br><br>
            <div class="row_images">
              <div class="column_image">
                <img src="img/bluetooth_rc_car/CaptureUI.PNG" alt="Snow" style="width:100%">
              </div>
            </div>
            <br>
            Don’t forget to change the properties of each component. To make a component taking all the width of
            the screen, you will have to set the width to “match parents”. Now it will take the full space of the
            parent element (see component palette). Don’t forget to simplify all your widgets by renaming it. If
            all the components are added, you can now click on connect (top left) and then Al companion. Here will
            popup a new window asking to scan a QR code. You will have to scan it by firstly downloading the MIT
            app inventor in the App and Play store. Open the app on your smartphone and scan the QR code. Now you
            can properly see the layout on your screen. If you are happy with your layout, we can now start with
            the logic part of the app. Click on the “block” button top right of the screen. Now you should see this
            on your screen.
            <br><br><br>
            <div class="row_images">
              <div class="column_image">
                <img src="img/bluetooth_rc_car/InkedMITblockG_LI.jpg" alt="test" style="width:100%">
              </div>
            </div>
            <br>
            Take some time to discover all the different block-codes by clicking on an element of the blocks palette.
            <br>
            Now let’s make our app!
            The first step will be to control the ListPicker. There are two control blocks we will use for it.
            These are called .BeforePicking and .AfterPicking. Inside we will set the BluetoothList.elements to
            the addresses and names of our BluetoothClient1 (you can find this instruction inside the
            BluetoothClient1 block).  That’s all for the .BeforePicking. For the .AfterPicking you will have
            to add a if-then control block which will only show the addresses and names of our BluetoothClient1
            if our smartphone is well-connected to the esp32. Therefore we use the “call BluetoothClient1.Connectaddress”
            function and by adding the Bluetooth.Selection to our block.
            <br><br>
            <div class="row_images">
              <div class="column_image">
                <img src="img/bluetooth_rc_car/InkedMITlist_LI.jpg" alt="test" style="width:100%">
              </div>
            </div>
            <br>
            Let’s now take a look at the Clock1 block. This is a function that will be called every 1000 milliseconds
            or every 1 seconds. The main function of it is to see if we are still connected to the esp32 and if
            we can clearly send data or not. So we have two if-then blocks, inside of it we first check if we are
            connected. If True then we can set our connection_label to “connected” with a green color. Otherwise we
            will set the text “not connected” with a red textcolor.
            <br><br><br>
            <div class="row_images">
              <div class="column_image">
                <img src="img/bluetooth_rc_car/InkedMITclock_LI.jpg" alt="Snow" style="width:100%">
              </div>
            </div>
            <br>
            Finally let’s talk about our buttons. For each button it’s the same thing. We declare two functions.
            One will be called when we’re pressing the button, the other one is called when we release the button.
            For each function we send a 1-bite number. The numbers are important for our arduino code later.
            <br><br><br>
            <div class="row_images">
              <div class="column_image">
                <img src="img/bluetooth_rc_car/CaptureButton.PNG" alt="Snow" style="width:100%">
              </div>
            </div>
            <br>
            Here are all the blocks needed for the app.
            <br><br><br>
            <div class="picture_text">
              <img src="img/bluetooth_rc_car/InkedCaptureAll_LI.jpg" alt="image" class="img-fluid text_image">
            </div>
          </div>


        <h3 class="title_text"><strong>Arduino code</strong></h3>
          <div class="text_text">
            Now let’s see how the arduino code works.
            We first include our Bluetooth library that you have to download in the library.
            Then we make objects for our library. and declare all our pin numbers. Finally we check
            if there are problems with the SDK of the smartphone.
            <br><br>
            In the setup section, we begin our Bluetooth serial communication by passing the name of our
            device in the parameters. Then we begin our serial communication at 115200 bps and we print a
            little message to say that everything is ok. Finally we declare all our pins as outputs. Pin 17
            will light up if we receive information no matter what it is. It’s there just to check for errors.
            <br><br><br>
            <pre class="arduino_code">
              <code class="arduino_lines">
                #include <BluetoothSerial.h>

                BluetoothSerial SerialBT;
                int BTData;

                byte motor1base1 = 26;
                byte motor1base2 = 27;
                byte motor2base1 = 25;
                byte motor2base2 = 33;

                /* Check if Bluetooth configurations are enabled in the SDK */
                #if !defined(CONFIG_BT_ENABLED) || !defined(CONFIG_BLUEDROID_ENABLED)
                #error Bluetooth is not enabled! Please run `make menuconfig` to and enable it
                #endif

                void setup()
                  {
                    Serial.begin(115200);
                    SerialBT.begin("hello world");
                    Serial.println("Bluetooth Started! Ready to pair...");
                    pinMode(motor1base1, OUTPUT);
                    pinMode(motor1base2, OUTPUT);
                    pinMode(motor2base1, OUTPUT);
                    pinMode(motor2base2, OUTPUT);
                    pinMode(17, OUTPUT);
                  }
              </code>
            </pre>
            <br><br>
            In the loop section we firstly see if we receive something. Yes, then we define our BTData variable and
            make the light blink. Then my code isn’t really optimised because we will each time check if the value
            corresponds to BTData. Yes, then we do something. I think the code is pretty clear.
            <br><br><br>
            <pre class="arduino_code">
              <code class="arduino_lines">
                void loop()
                  {
                    if(SerialBT.available())
                    {
                      BTData = SerialBT.read();
                      //Serial.write(BTData);
                      digitalWrite(17, HIGH);
                    }

                    if (BTData == 48) {
                      // left start
                      digitalWrite(motor1base1, HIGH);
                      digitalWrite(motor1base2, LOW);
                      digitalWrite(motor2base1, LOW);
                      digitalWrite(motor2base2, HIGH);
                    } else if (BTData == 49) {
                      // left stop
                      digitalWrite(motor1base1, LOW);
                      digitalWrite(motor1base2, LOW);
                      digitalWrite(motor2base1, LOW);
                      digitalWrite(motor2base2, LOW);
                    } else if (BTData == 50) {
                      // forward start
                      digitalWrite(motor1base1, HIGH);
                      digitalWrite(motor1base2, LOW);
                      digitalWrite(motor2base1, HIGH);
                      digitalWrite(motor2base2, LOW);
                    } else if (BTData == 51) {
                      // forward stop
                      digitalWrite(motor1base1, LOW);
                      digitalWrite(motor1base2, LOW);
                      digitalWrite(motor2base1, LOW);
                      digitalWrite(motor2base2, LOW);
                    } else if (BTData == 52) {
                      // right start
                      digitalWrite(motor1base1, LOW);
                      digitalWrite(motor1base2, HIGH);
                      digitalWrite(motor2base1, HIGH);
                      digitalWrite(motor2base2, LOW);
                    } else if (BTData == 53) {
                      // right stop
                      digitalWrite(motor1base1, LOW);
                      digitalWrite(motor1base2, LOW);
                      digitalWrite(motor2base1, LOW);
                      digitalWrite(motor2base2, LOW);
                    } else if (BTData == 54) {
                      // backward start
                      digitalWrite(motor1base1, LOW);
                      digitalWrite(motor1base2, HIGH);
                      digitalWrite(motor2base1, LOW);
                      digitalWrite(motor2base2, HIGH);
                    } else if (BTData == 55) {
                      // backward stop
                      digitalWrite(motor1base1, LOW);
                      digitalWrite(motor1base2, LOW);
                      digitalWrite(motor2base1, LOW);
                      digitalWrite(motor2base2, LOW);
                    } else {
                      digitalWrite(25, LOW);
                      digitalWrite(26, LOW);
                      digitalWrite(14, LOW);
                      digitalWrite(12, LOW);
                    }
                  }
              </code>
            </pre>
            <br>
         <h3 class="title_text"><strong>Arduino Code</strong></h3>
           <div class="text_text">
             Here's the entire code :
           </div>
           <br>
           <pre class="arduino_code">
             <code class="arduino_lines">
               #include <BluetoothSerial.h>

                BluetoothSerial SerialBT;
                int BTData;

                byte motor1base1 = 26;
                byte motor1base2 = 27;
                byte motor2base1 = 25;
                byte motor2base2 = 33;

                /* Check if Bluetooth configurations are enabled in the SDK */
                #if !defined(CONFIG_BT_ENABLED) || !defined(CONFIG_BLUEDROID_ENABLED)
                #error Bluetooth is not enabled! Please run `make menuconfig` to and enable it
                #endif

                void setup()
                {
                  Serial.begin(115200);
                  SerialBT.begin("hello world");
                  Serial.println("Bluetooth Started! Ready to pair...");
                  pinMode(motor1base1, OUTPUT);
                  pinMode(motor1base2, OUTPUT);
                  pinMode(motor2base1, OUTPUT);
                  pinMode(motor2base2, OUTPUT);
                  pinMode(17, OUTPUT);
                }

                void loop()
                {
                  if(SerialBT.available())
                  {
                    BTData = SerialBT.read();
                    //Serial.write(BTData);
                    digitalWrite(17, HIGH);
                  }

                  if (BTData == 48) {
                    // left start
                    digitalWrite(motor1base1, HIGH);
                    digitalWrite(motor1base2, LOW);
                    digitalWrite(motor2base1, LOW);
                    digitalWrite(motor2base2, HIGH);
                  } else if (BTData == 49) {
                    // left stop
                    digitalWrite(motor1base1, LOW);
                    digitalWrite(motor1base2, LOW);
                    digitalWrite(motor2base1, LOW);
                    digitalWrite(motor2base2, LOW);
                  } else if (BTData == 50) {
                    // forward start
                    digitalWrite(motor1base1, HIGH);
                    digitalWrite(motor1base2, LOW);
                    digitalWrite(motor2base1, HIGH);
                    digitalWrite(motor2base2, LOW);
                  } else if (BTData == 51) {
                    // forward stop
                    digitalWrite(motor1base1, LOW);
                    digitalWrite(motor1base2, LOW);
                    digitalWrite(motor2base1, LOW);
                    digitalWrite(motor2base2, LOW);
                  } else if (BTData == 52) {
                    // right start
                    digitalWrite(motor1base1, LOW);
                    digitalWrite(motor1base2, HIGH);
                    digitalWrite(motor2base1, HIGH);
                    digitalWrite(motor2base2, LOW);
                  } else if (BTData == 53) {
                    // right stop
                    digitalWrite(motor1base1, LOW);
                    digitalWrite(motor1base2, LOW);
                    digitalWrite(motor2base1, LOW);
                    digitalWrite(motor2base2, LOW);
                  } else if (BTData == 54) {
                    // backward start
                    digitalWrite(motor1base1, LOW);
                    digitalWrite(motor1base2, HIGH);
                    digitalWrite(motor2base1, LOW);
                    digitalWrite(motor2base2, HIGH);
                  } else if (BTData == 55) {
                    // backward stop
                    digitalWrite(motor1base1, LOW);
                    digitalWrite(motor1base2, LOW);
                    digitalWrite(motor2base1, LOW);
                    digitalWrite(motor2base2, LOW);
                  } else {
                    digitalWrite(25, LOW);
                    digitalWrite(26, LOW);
                    digitalWrite(14, LOW);
                    digitalWrite(12, LOW);
                  }
                }
             </code>
           </pre>
          <h3 class="title_text"><strong>Conclusion</strong></h3>
            <div class="text_text">
              Voila, now you know how I made it, hope you enjoyed it, don't hesitate to watch my other
              projects… Thanks.
            </div>
            <h4 class="title_text"><strong>Thank You</strong></h4>

      </section>
      <!--Section: Content-->
    </div>
  </main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="bg-light text-lg-start">
    <hr class="m-0" />
    <div class="text-center py-4 align-items-center">
      <p>Follow ThunderCode.io on GITHUB</p>
      <a href="https://github.com/getgetstechno?tab=repositories" class="btn btn-primary m-1" role="button" rel="nofollow"
        target="_blank">
        <i class="fab fa-github"></i>
      </a>
    </div>

    <!-- Copyright -->
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
      © 2021 Copyright:
      <a class="text-dark" href="blog-template.html">ThunderCode.io</a>
    </div>
    <div class="flaticon">
      <div>Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
    </div>
    <!-- Copyright -->
  </footer>
  <!--Footer-->
    <!-- MDB -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <!-- Custom scripts -->
    <script type="text/javascript" src="js/script.js"></script>
</body>
</html>
