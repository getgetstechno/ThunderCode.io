<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <meta name="description" content="Learn how to make your own DIY, free electric skateboard by using a recycled scooter and old skateboard.">
    <title>ThunderCode.io/Bluetooth esp32 tank l293d BluetoothSerial MIT App Inventor</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" />
    <!-- Google Fonts Roboto -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
    <!-- MDB -->
    <link rel="stylesheet" href="css/mdb.min.css" />
    <!-- Custom styles -->
    <link rel="stylesheet" href="css/style.css" />
</head>
<body>
      <header>
    <!-- Intro settings -->
    <style>
      #intro {
        /* Margin to fix overlapping fixed navbar */
        margin-top: 58px;
      }
      @media (max-width: 991px) {
        #intro {
          /* Margin to fix overlapping fixed navbar */
          margin-top: 45px;
        }
      }
    </style>

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top">
      <div class="container-fluid">
        <!-- Navbar brand -->
        <a class="navbar-brand" href="https://getgetstechno.github.io/ThunderCode.io/">
          <img src="img/icon/logo64.png" height="35" alt="logo" loading="lazy"
            style="margin-top: -3px;" />
        </a>
        <button class="navbar-toggler" type="button" data-mdb-toggle="collapse" data-mdb-target="#navbarExample01"
          aria-controls="navbarExample01" aria-expanded="false" aria-label="Toggle navigation">
          <i class="fas fa-bars"></i>
        </button>
        <div class="collapse navbar-collapse" id="navbarExample01">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item active">
              <a class="nav-link" aria-current="page" href="index.html">HOME</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="embedded_systems.html" rel="nofollow"
                >All Projects</a>
            </li>
          </ul>

          <ul class="navbar-nav d-flex flex-row">
            <!-- Icons -->
            <li class="nav-item me-3 me-lg-0">
              <a class="nav-link" href="https://github.com/getgetstechno?tab=repositories" rel="nofollow" target="_blank">
                <i class="fab fa-github"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- Navbar -->

    <!-- Jumbotron -->
    <div id="intro" class="p-5 text-center bg-light">
      <h1 class="mb-3 h2">DARTS ROBOT PROTOTYPE IV</h1>
      <p class="mb-3">Second part of my DIY darts robot! The main goal
        here is to confirm the slingshot system and to make the first working prototype that can trow a dart!</p>
      <a class="btn btn-primary m-2" href="embedded_systems.html" role="button" rel="nofollow"
        >All Projects</a>
    </div>
    <!-- Jumbotron -->
  </header>
  <!--Main Navigation-->

  <!--Main layout-->
  <main class="my-5">
    <div class="container">
      <!--Section: Content-->
      <section class="text-center">

        <div class="text_text">
          If you haven't seen the first part of the project. I highly suggest you read it.
          You will have a more global view of what I am doing.
          <br><br>
          <a class="btn btn-primary m-2" href="DRprototypeIII.html" role="button" rel="nofollow"
            >Parts 1, first prototype</a>
        </div>

        <h2 class="title_text"><strong>Prototype IV : upgrading prototype III</strong></h2>
        <br>
          <div class="row_images">
            <div class="column_image">
              <img src="img/protoIV/all.JPG" alt="crossbow" style="width:100%">
            </div>
          </div>
          <br>
          <h4 class="sub_text"><strong>Goal</strong></h4>
          The goal of prototype IV will be to resolve all the problems of prototype III, which means :
          decreasing the loading time of the cannon, adding 2 additional cannons to divide the loading
          time by 3, changing the code, so I can control 2 or more motors at the same time, changing the rotational
          mechanism so the robot could be more precise, combining shift registers with stepper motors. The automation
          will happen in prototype V. For now, I will try to control the robot using a remote controller.
          <br><br>

          <h4 class="sub_text"><strong>Building the lower part</strong></h4>
          In prototype III, I told you that the robot has a problem with the horizontal aiming system.
          The fact was that the robot had to rotate on hisself to aim. That is not a good solution.
          I tried adding chains. The robot could then move in all directions. The problem with such a system is
          that you need a rough floor. Another big issue is that it is really complicated to automate a tank in the
          sense that the tank won’t always be positioned perpendicular to the dart board.

          The solution I found was to use wheels. To make sure the robot could move in any direction, I decided to
          place wheels in both directions, perpendicular to each other. The wheels can’t rotate on themselves. The
          next thing I had to include was a system where the robot could lift the wheels in one direction otherwise
          the robot would never have the possibility to move. That has also a big advantage, when I am ready to shoot,
          I can stabilize the robot by placing the wheels on the same height.
          <br><br>
          <div class="row_images">
            <div class="column_image">
              <img src="img/protoIV/lower1.JPG" alt="crossbow" style="width:100%">
            </div>
            <div class="column_image">
              <img src="img/protoIV/up.JPG" alt="crossbow" style="width:100%">
            </div>
          </div>

          <h4 class="sub_text"><strong>Building the cannon</strong></h4>
          The cannon has been improved, in the sense that there are now 3 cannons instead of one. The main reason why 3
          is because to play darts you have to throw 3 darts before the other one can play. Because I switched the elastics
          for some smaller ones, I could now use only one stepper motor to load one cannon. Instead of using one trigger for
          each cannon, I decided to put one big trigger controlled by a stepper motor instead of a servo motor.
          <br><br>
          <div class="row_images">
            <div class="column_image">
              <img src="img/protoIV/canon2.JPG" alt="crossbow" style="width:100%">
            </div>
            <div class="column_image">
              <img src="img/protoIV/canon.JPG" alt="crossbow" style="width:100%">
            </div>
          </div>

          <h4 class="sub_text"><strong>Electronic part</strong></h4>
          For the electronic part, I decided to use an ESP32 instead of an Arduino UNO. The whole system uses 8 different
          motors (3 for the wheels, 3 for the cannons, 1 for the trigger and 1 for the angle). Because each motor has to be
          controlled by 4 pins, I normally had 32 pins to control. Which is way too much. So I had to use a shift register.
          More precisely a SIPO (serial in, parallel out) shift register.
          <br>
          <div class="column_image">
            <img src="img/protoIV/SN74HC595.jpg" alt="crossbow" style="width:50%">
          </div>
          <br>
          The way it works is by sending him a byte of data. He will then split it in 8 values (1 or 0). If the value is 1,
          then the shift register (which contains 8 parallel out pins), will send current to the pin corresponding to the
          index on which the value equals 1. If it’s 0, he won’t send any current. So for example if we send byte
          [0][1][0][1][0][1][0][1], the shift register will send current to the pins number 1, 3, 5, 7 (we start at index 0).
          A shift register needs 3 pins to work but you can control 8 pins with it. So for now, I can control my 8 motors using
          only 12 pins on the esp32.
          <br><br>
          Now using a shift register to control a stepper motor is not that easy. Normally I would have used a library to
          control it, but here it is impossible. So I started searching, and by investigating the source code of the stepper.h
          library (<a href="https://github.com/arduino-libraries/Stepper/blob/master/src/Stepper.cpp">link</a>), I found something interesting. A stepper motor like any other motor, turns by alternating the magnetic
          field using some coils. Now this alternation has to happen in a precise order at a precise moment to make it turn.
          What I found out in the source code was the order in which the coils have to be alternated for the type of stepper
          motor I use.
          <br><br>
          Because it’s is in a loop, I can put the data in an array, and control it by using a for loop.
          <br><br>
          <div class="column_image">
            <img src="img/protoIV/circuit4.PNG" alt="crossbow" style="width:100%">
          </div>
          <br><br>
          <pre class="arduino_code">
            <code class="arduino_lines">
        const byte latchPin1 = 18;    // ST_CP pin 18     // uno = 11
        const byte clockPin1 = 5;     // SH_CP pin 5     // uno = 12
        const byte dataPin1 = 19;     // DS pin 19        // uno = 10

        const char motorCW1[] = {B10000000, B11000000, B01000000, B01100000, B00100000, B00110000, B00010000, B10010000};
        const char motorCW2[] = {B00001000, B00001100, B00000100, B00000110, B00000010, B00000011, B00000001, B00001001};
        const char motorCCW1[] = {B10010000, B00010000, B00110000, B00100000, B01100000, B01000000, B11000000, B10000000};
        const char motorCCW2[] = {B00001001, B00000001, B00000011, B00000010, B00000110, B00000100, B00001100, B00001000};


        void setup() {
          pinMode(latchPin1, OUTPUT);
          pinMode(clockPin1, OUTPUT);
          pinMode(dataPin1, OUTPUT);
        }

        void loop() {
          for(int i = 0; i < 8; i++) {
              digitalWrite(latchPin1, LOW);
              shiftOut(dataPin1, clockPin1, MSBFIRST, (motorCCW1[i]));
              digitalWrite(latchPin1, HIGH);
              delay(1);
            }
        }
            </code>
          </pre>
          <br>
          To control the motors, I firstly tried it with some potentiometers like in prototype III, unfortunately there were too
          many errors (probably because the potentiometers were too cheap). They also needed a lot of pins. I then came to the idea
          of using the infrared controller. It is a good alternative because you can control it at distance and because it only
          requires 1 pin. I then added 4 leds to it, they give me the information about how many buttons are now pressed on
          the controller. Here you can find the entire electronic circuit :
          <br><br>
          <div class="column_image">
            <img src="img/protoIV/circuitfinal.PNG" alt="final circuit" style="width:100%">
          </div>
          <br><br>
          I won’t explain the entire code here, but you can find it on <a href="https://github.com/getgetstechno/darts-robot/blob/main/prototypeIV/prototypeIV.ino">github</a>. I even placed a lot of comments on it so I hope you won’t be lost.
          <br><br><br>

            <a class="btn btn-primary m-2" href="DRprototypeIV.html" role="button" rel="nofollow"
              >part 3 coming soon</a>
            <br><br>
        <h4 class="title_text"><strong>Thank You</strong></h4>

      </section>
      <!--Section: Content-->
    </div>
  </main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="bg-light text-lg-start">
    <hr class="m-0" />
    <div class="text-center py-4 align-items-center">
      <p>Follow ThunderCode.io on GITHUB</p>
      <a href="https://github.com/getgetstechno?tab=repositories" class="btn btn-primary m-1" role="button" rel="nofollow"
        target="_blank">
        <i class="fab fa-github"></i>
      </a>
    </div>

    <!-- Copyright -->
    <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
      © 2021 Copyright:
      <a class="text-dark" href="blog-template.html">ThunderCode.io</a>
    </div>
    <div class="flaticon">
      <div>Icons made by <a href="https://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div>
    </div>
    <!-- Copyright -->
  </footer>
  <!--Footer-->
    <!-- MDB -->
    <script type="text/javascript" src="js/mdb.min.js"></script>
    <!-- Custom scripts -->
    <script type="text/javascript" src="js/script.js"></script>
</body>
</html>
